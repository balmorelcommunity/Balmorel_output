DROP TABLE if exists `Technology characteristics`;
CREATE TABLE `Technology characteristics`(`Case`,`Technology`,`Fuel type`,`Technology Type`,`Technology Category`,`CHP CB-value` REAL,`CHP CV-value` REAL,`Fuel efficiency` REAL,`Investment cost M€/MW` REAL,`Variable operating and maintenance cost €/MWh` REAL,`Annual fixed operational cost k€/MW` REAL,`Technology available from year` REAL,`Technology available until year` REAL,`Investment technology (yes/no)`,`Lifetime` REAL,`Time to unload storage` REAL,`Time to load storage` REAL);
INSERT INTO `Technology characteristics` (`Case`,`Technology`,`Fuel type`,`Technology Type`,`CHP CB-value`,`CHP CV-value`,`Fuel efficiency`,`Investment cost M€/MW`,`Variable operating and maintenance cost €/MWh`,`Annual fixed operational cost k€/MW`,`Technology available from year`,`Technology available until year`,`Investment technology (yes/no)`,`Lifetime`,`Time to unload storage`,`Time to load storage`) SELECT GDATA,GDATA3,IGF.IGF4,MAX(CASE GDATA4 WHEN 'GDTYPE' then Value else null end),MAX(CASE GDATA4 WHEN 'GDCB' then Value else null end),MAX(CASE GDATA4 WHEN 'GDCV' then Value else null end),MAX(CASE GDATA4 WHEN 'GDFE' then Value else null end),MAX(CASE GDATA4 WHEN 'GDINVCOST0' then Value else null end),MAX(CASE GDATA4 WHEN 'GDOMVCOST0' then Value else null end),mAX(CASE GDATA4 WHEN 'GDOMFCOST0' then Value else null end),MAX(CASE GDATA4 WHEN 'GDFROMYEAR' then Value else null end),MAX(CASE GDATA4 WHEN 'GDLASTYEAR' then Value else null end), MAX(CASE GDATA4 WHEN 'GDKVARIABL' then Value else null end), MAX(CASE GDATA4 WHEN 'GDLIFETIME' then Value else null end), MAX(CASE GDATA4 WHEN 'GDSTOHUNLD' then Value else null end), MAX(CASE GDATA4 WHEN 'GDSTOHLOAD' then Value else null end) FROM IGF INNER JOIN GDATA ON GDATA.GDATA = IGF.IGF AND GDATA.GDATA3=IGF.IGF3 GROUP BY GDATA,GDATA3;
UPDATE [Technology characteristics] SET `Technology Type` = CASE WHEN EXISTS (SELECT * FROM IGCND WHERE ([Technology characteristics].[Case] =  IGCND.IGCND) AND ([Technology characteristics].[Technology] = IGCND.IGCND3)) THEN  'Condensing' WHEN EXISTS (SELECT * FROM IGBPR WHERE ([Technology characteristics].[Case] = IGBPR.IGBPR) AND ([Technology characteristics].[Technology] = IGBPR.IGBPR3)) THEN 'Backpressure' WHEN EXISTS (SELECT * FROM IGEXT WHERE ([Technology characteristics].[Case] = IGEXT.IGEXT) AND ([Technology characteristics].[Technology] = IGEXT.IGEXT3)) THEN 'Extraction' WHEN EXISTS (SELECT * FROM IGHOB WHERE ([Technology characteristics].[Case] = IGHOB.IGHOB) AND ([Technology characteristics].[Technology] = IGHOB.IGHOB3)) THEN 'Boiler' WHEN EXISTS (SELECT * FROM IGETOH WHERE ([Technology characteristics].[Case] = IGETOH.IGETOH) AND ([Technology characteristics].[Technology] = IGETOH.IGETOH3)) THEN 'Electricity to heat' WHEN EXISTS (SELECT * FROM IGESTO WHERE ([Technology characteristics].[Case] = IGESTO.IGESTO) AND ([Technology characteristics].[Technology] = IGESTO.IGESTO3)) THEN 'Electricity storage - Short term storage capacity' WHEN EXISTS (SELECT * FROM IGESTOS WHERE ([Technology characteristics].[Case] = IGESTOS.IGESTOS) AND ([Technology characteristics].[Technology] = IGESTOS.IGESTOS3)) THEN 'Electricity storage - Long term storage capacity' WHEN EXISTS (SELECT * FROM IGHSTO WHERE ([Technology characteristics].[Case] = IGHSTO.IGHSTO) AND ([Technology characteristics].[Technology] = IGHSTO.IGHSTO3)) THEN 'Heat storage - Short term storage capacity' WHEN EXISTS (SELECT * FROM IGHSTOS WHERE ([Technology characteristics].[Case] = IGHSTOS.IGHSTOS) AND ([Technology characteristics].[Technology] = IGHSTOS.IGHSTOS3)) THEN 'Heat storage - Long term storage capacity' WHEN EXISTS (SELECT * FROM IGHYRS WHERE ([Technology characteristics].[Case] = IGHYRS.IGHYRS) AND ([Technology characteristics].[Technology] = IGHYRS.IGHYRS3)) THEN 'Hydro reservoir' WHEN EXISTS (SELECT * FROM IGHYRR WHERE ([Technology characteristics].[Case] = IGHYRR.IGHYRR) AND ([Technology characteristics].[Technology] = IGHYRR.IGHYRR3)) THEN 'Hydro ROR' WHEN EXISTS (SELECT * FROM IGWND WHERE ([Technology characteristics].[Case] = IGWND.IGWND) AND ([Technology characteristics].[Technology] = IGWND.IGWND3)) THEN 'Wind' WHEN EXISTS (SELECT * FROM IGSOLE WHERE ([Technology characteristics].[Case] = IGSOLE.IGSOLE) AND ([Technology characteristics].[Technology] = IGSOLE.IGSOLE3)) THEN 'Solar PV' WHEN EXISTS (SELECT * FROM IGSOLH WHERE ([Technology characteristics].[Case] = IGSOLH.IGSOLH) AND ([Technology characteristics].[Technology] = IGSOLH.IGSOLH3)) THEN 'Solar heat' WHEN EXISTS (SELECT * FROM IGWAVE WHERE ([Technology characteristics].[Case] = IGWAVE.IGWAVE) AND ([Technology characteristics].[Technology] = IGWAVE.IGWAVE3)) THEN 'Wave' END;
UPDATE [Technology characteristics] SET [Technology Category] = CASE WHEN [Technology Type] IN ('Condensing') THEN 'Thermal power' WHEN [Technology Type] IN ('Backpressure','Extraction') THEN 'CHP' WHEN [Technology Type] IN ('Wind','Solar PV','Solar heat') THEN 'VRE' WHEN [Technology Type] IN ('Hydro ROR','Hydro reservoir') THEN 'Hydro power' WHEN [Technology Type] IN ('Electricity storage - Short term storage capacity','Electricity storage - Long term storage capacity','Heat storage - Short term storage capacity','Heat storage - Long term storage capacity') THEN 'Storage' WHEN [Technology Type] IN ('Electricity to heat','Power to gas') THEN 'P2X' ELSE 'Boiler' END;
DROP VIEW if exists `El_Gen`;
CREATE VIEW EL_Gen(`Case`,BaseYear,ModelYear,Area,Technology,Season,Term,Generation_MW) AS SELECT VGE_T,VGE_T2,VGE_T3,VGE_T4,VGE_T5,VGE_T6,VGE_T7,level FROM VGE_T WHERE level >0 UNION SELECT VESTOLOADT,VESTOLOADT2,VESTOLOADT3,VESTOLOADT4,'IntraSeasonal Storage',VESTOLOADT5,VESTOLOADT6,(-1)*VESTOLOADT.LEVEL FROM VESTOLOADT WHERE LEVEL >0 UNION SELECT VESTOLOADTS,VESTOLOADTS2,VESTOLOADTS3,VESTOLOADTS4,'InterSeasonal Storage',VESTOLOADTS5,VESTOLOADTS6,(-1)*VESTOLOADTS.LEVEL FROM VESTOLOADTS WHERE LEVEL >0;
DROP TABLE if exists `Electricity generation - Term`;
CREATE TABLE `Electricity generation - Term` (`Case` ,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`Season`,`Term`,`MW` REAL,`MWh`REAL,`GJ` REAL);
INSERT INTO `Electricity generation - Term` SELECT [El_Gen].[Case],[El_Gen].BaseYear,[El_Gen].ModelYear,ICA.ICA3,RRRAAA.RRRAAA3,[El_Gen].Area,IGF.IGF4,Tech.[Technology Category],Tech.[Technology Type],[El_Gen].Technology,[El_Gen].Season,[El_Gen].Term, Sum([El_Gen].Generation_MW), Sum([El_Gen].[Generation_MW]*[IHOURSINST].[value]), Sum([El_Gen].[Generation_MW]*[IHOURSINST].[value])*3.6 FROM [Technology characteristics] AS Tech INNER JOIN (IHOURSINST INNER JOIN (IGF INNER JOIN (ICA INNER JOIN (RRRAAA INNER JOIN [El_Gen] ON RRRAAA.RRRAAA = [El_Gen].[Case] AND RRRAAA.RRRAAA4 = [El_Gen].Area) ON ICA.ICA4 = [El_Gen].AREA AND [El_Gen].[Case] = ICA.ICA) ON IGF.IGF3=[El_Gen].Technology AND [El_Gen].[Case] = IGF.IGF) ON IHOURSINST.IHOURSINST4=[El_Gen].Term AND IHOURSINST.IHOURSINST3 = [El_Gen].Season AND IHOURSINST.IHOURSINST = [El_Gen].[Case]) ON Tech.[Case]=[El_Gen].[Case] AND Tech.[Technology]=[El_Gen].[Technology] GROUP BY [El_Gen].[Case],[El_Gen].BaseYear,[El_Gen].ModelYear,[El_Gen].Area,[El_Gen].Technology,[El_Gen].Season,[El_Gen].Term;
UPDATE [Electricity generation - Term] SET MW = MW *(-1), MWh = MWh *(-1), GJ = GJ *(-1) WHERE [Electricity generation - Term].[Technology Type] = 'Electricity to heat';
DELETE FROM 'Electricity generation - Term' WHERE NOT (COUNTRY IN ( 'DENMARK','ESTONIA','NORWAY','FINLAND','GERMANY','NETHERLANDS','SWEDEN','UNITED_KINGDOM','LATVIA','LITHUANIA','POLAND','BELGIUM','FRANCE'));
DELETE FROM [Electricity generation - Term] WHERE NOT (([Electricity generation - Term].BaseYear=[Electricity generation - Term].ModelYear AND [Electricity generation - Term].BaseYear<(SELECT MAX([Electricity generation - Term].BaseYear) FROM [Electricity generation - Term])) OR ([Electricity generation - Term].BaseYear=(SELECT MAX([Electricity generation - Term].BaseYear) FROM [Electricity generation - Term]) )) ;
DROP TABLE if exists `Electricity generation - Annual`;
CREATE TABLE `Electricity generation - Annual` (`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`TWh`REAL,`PJ` REAL);
INSERT INTO `Electricity generation - annual` SELECT GE_T.`Case`,GE_T.BaseYear,GE_T.ModelYear,GE_T.Country,GE_T.Region,GE_T.Area,GE_T.Fuel,GE_T.[Technology Category],GE_T.[Technology Type],GE_T.Technology, Sum([MWh]/1000000) AS TWh, Sum([GJ]/1000000) AS PJ FROM [Electricity generation - Term] AS GE_T GROUP BY GE_T.`Case`,GE_T.BaseYear,GE_T.ModelYear,GE_T.Country,GE_T.Region,GE_T.Area,GE_T.Fuel,GE_T.[Technology Category],GE_T.[Technology Type],GE_T.Technology;
DROP TABLE if exists `Electricity_price`;
CREATE TABLE `Electricity_price`(`Case`TEXT,`BaseYear` TEXT, `ModelYear` TEXT,`Country` TEXT,`Region` TEXT,`Season` TEXT,`Term` TEXT,`OMONEY/MWh` REAL);
INSERT INTO `Electricity_price`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Season`,`Term`,`OMONEY/MWh`) SELECT QEEQ.QEEQ, QEEQ.QEEQ2,QEEQ.QEEQ3,CCCRRR.CCCRRR3,QEEQ.QEEQ4,QEEQ.QEEQ5,QEEQ.QEEQ6, Avg([QEEQ].[marginal]*[OMONEY].[value]/(IDISCOUNTFACTOR.value*[IHOURSINST].[value]*IWEIGHTY.VALUE)) FROM CCCRRR INNER JOIN (OMONEY INNER JOIN (IWEIGHTY INNER JOIN (IDISCOUNTFACTOR INNER JOIN (QEEQ INNER JOIN IHOURSINST ON (QEEQ.QEEQ6 = IHOURSINST.IHOURSINST4) AND (QEEQ.QEEQ = IHOURSINST.IHOURSINST) AND (QEEQ.QEEQ5 = IHOURSINST.IHOURSINST3)) ON (IDISCOUNTFACTOR.IDISCOUNTFACTOR = QEEQ.QEEQ AND IDISCOUNTFACTOR.IDISCOUNTFACTOR3 = QEEQ.QEEQ3)) ON (IWEIGHTY.IWEIGHTY = QEEQ.QEEQ AND IWEIGHTY.IWEIGHTY3 = QEEQ.QEEQ3)) ON OMONEY.OMONEY = QEEQ.QEEQ) ON (CCCRRR.CCCRRR4 = QEEQ.QEEQ4) AND (CCCRRR.CCCRRR = QEEQ.QEEQ) GROUP BY QEEQ.QEEQ, QEEQ.QEEQ2, CCCRRR.CCCRRR3, QEEQ.QEEQ3, QEEQ.QEEQ4, QEEQ.QEEQ5, QEEQ.QEEQ6;
DELETE FROM Electricity_price WHERE NOT ((BaseYear=ModelYear AND BaseYear<(SELECT MAX(BaseYear) FROM [Electricity_price])) OR (BaseYear=(SELECT MAX(BaseYear) FROM [Electricity_price]) )) ;
DROP TABLE if exists`Heat Price - Marginal`;
CREATE TABLE `Heat price - Marginal`(`Case` TEXT,BaseYear TEXT,ModelYear TEXT,Country TEXT,Region TEXT,Area TEXT,Season TEXT,Term TEXT,`OMONEY/GJ` REAL,`OMONEY/MWh` REAL);
INSERT INTO `Heat price - Marginal`(`Case`,BaseYear,ModelYear,Country,Region,Area,Season,Term,`OMONEY/GJ`,`OMONEY/MWh`) SELECT QHEQ.QHEQ, QHEQ.QHEQ2, QHEQ.QHEQ3,ICA.ICA3,RRRAAA.RRRAAA3,QHEQ.QHEQ4,QHEQ.QHEQ5,QHEQ.QHEQ6,(Avg([QHEQ].[marginal]*[OMONEY].[value]/(IWEIGHTY.VALUE*[IHOURSINST].[value]*IDISCOUNTFACTOR.VALUE)))/3.6, (Avg([QHEQ].[marginal]*[OMONEY].[value]/(IWEIGHTY.VALUE*[IHOURSINST].[value]*IDISCOUNTFACTOR.VALUE))) FROM ICA INNER JOIN (IDISCOUNTFACTOR INNER JOIN (IWEIGHTY INNER JOIN (RRRAAA INNER JOIN (OMONEY INNER JOIN (QHEQ INNER JOIN IHOURSINST ON (QHEQ.QHEQ6 = IHOURSINST.IHOURSINST4) AND (QHEQ.QHEQ = IHOURSINST.IHOURSINST) AND (QHEQ.QHEQ5 = IHOURSINST.IHOURSINST3)) ON (OMONEY.OMONEY = QHEQ.QHEQ)) ON (RRRAAA.RRRAAA4 = QHEQ.QHEQ4) AND (RRRAAA.RRRAAA = QHEQ.QHEQ)) ON (IWEIGHTY.IWEIGHTY = QHEQ.QHEQ AND IWEIGHTY.IWEIGHTY3 = QHEQ.QHEQ3)) ON (IDISCOUNTFACTOR.IDISCOUNTFACTOR = QHEQ.QHEQ AND IDISCOUNTFACTOR.IDISCOUNTFACTOR3 = QHEQ.QHEQ3)) ON (QHEQ.QHEQ4=ICA.ICA4) AND (QHEQ.QHEQ=ICA.ICA) WHERE QHEQ.level <>0 GROUP BY QHEQ.QHEQ, QHEQ.QHEQ2,ICA.ICA3, RRRAAA.RRRAAA3, QHEQ.QHEQ3, QHEQ.QHEQ4, QHEQ.QHEQ5, QHEQ.QHEQ6;
DELETE FROM [Heat price - Marginal] WHERE NOT ((BaseYear=ModelYear AND BaseYear<(SELECT MAX(BaseYear) FROM [Heat price - Marginal])) OR (BaseYear=(SELECT MAX(BaseYear) FROM [Heat price - Marginal]) )) ;
DROP VIEW if exists `Heat_Gen`;
CREATE VIEW Heat_Gen(`Case`,BaseYear,ModelYear,Area,Technology,Season,Term,Generation_MW) AS SELECT VGH_T,VGH_T2,VGH_T3,VGH_T4,VGH_T5,VGH_T6,VGH_T7,level FROM VGH_T WHERE level >0 UNION SELECT VHSTOLOADT,VHSTOLOADT2,VHSTOLOADT3,VHSTOLOADT4,'IntraSeasonal Storage',VHSTOLOADT5,VHSTOLOADT6,(-1)*VHSTOLOADT.LEVEL FROM VHSTOLOADT WHERE LEVEL >0 UNION SELECT VHSTOLOADTS,VHSTOLOADTS2,VHSTOLOADTS3,VHSTOLOADTS4,'InterSeasonal Storage',VHSTOLOADTS5,VHSTOLOADTS6,(-1)*VHSTOLOADTS.LEVEL FROM VHSTOLOADTS WHERE LEVEL >0;
DROP TABLE if exists `Heat Generation - Term`;
CREATE TABLE `Heat Generation - Term` (`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`Season`,`Term`,`MW` REAL,`MWh`REAL,`GJ` REAL);
INSERT INTO `Heat generation - Term` SELECT [Heat_Gen].[Case],[Heat_Gen].BaseYear,[Heat_Gen].ModelYear,ICA.ICA3,RRRAAA.RRRAAA3,[Heat_Gen].Area,IGF.IGF4,Tech.[Technology Category],Tech.[Technology Type],[Heat_Gen].Technology,[Heat_Gen].Season,[Heat_Gen].Term,Sum([Heat_Gen].Generation_MW),Sum([Heat_Gen].[Generation_MW]*[IHOURSINST].[value]), Sum([Heat_Gen].[Generation_MW]*[IHOURSINST].[value])*3.6 FROM [Technology characteristics] AS Tech INNER JOIN (IHOURSINST INNER JOIN (ICA INNER JOIN (IGF INNER JOIN (RRRAAA INNER JOIN [Heat_Gen] ON RRRAAA.RRRAAA=[Heat_Gen].[Case] AND RRRAAA.RRRAAA4 = [Heat_Gen].Area) ON IGF.IGF3=[Heat_Gen].Technology AND [Heat_Gen].[Case] = IGF.IGF) ON ICA.ICA4 = [Heat_Gen].AREA AND [Heat_Gen].[Case] = ICA.ICA) ON IHOURSINST.IHOURSINST4=[Heat_Gen].Term AND IHOURSINST.IHOURSINST3 = [Heat_Gen].Season AND IHOURSINST.IHOURSINST = [Heat_Gen].[Case]) ON Tech.[Case]=[Heat_Gen].[Case] AND Tech.[Technology]=[Heat_Gen].[Technology] GROUP BY [Heat_Gen].[Case],[Heat_Gen].BaseYear,[Heat_Gen].ModelYear,ICA.ICA3,RRRAAA.RRRAAA3,[Heat_Gen].Area,IGF.IGF4,[Heat_Gen].Technology,[Heat_Gen].Season,[Heat_Gen].Term,[Heat_Gen].Generation_MW;
DELETE FROM 'Heat Generation - Term' WHERE NOT (COUNTRY IN ( 'DENMARK','ESTONIA','NORWAY','FINLAND','GERMANY','NETHERLANDS','SWEDEN','UNITED_KINGDOM','LATVIA','LITHUANIA','POLAND','BELGIUM','FRANCE'));
DELETE FROM [Heat Generation - Term] WHERE NOT ((BaseYear=ModelYear AND BaseYear<(SELECT MAX(BaseYear) FROM [Heat Generation - Term])) OR (BaseYear=(SELECT MAX(BaseYear) FROM [Heat Generation - Term]) )) ;
DROP TABLE if exists `Heat Generation - Annual`;
CREATE TABLE `Heat Generation - Annual` (`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`TWh`REAL,`PJ` REAL);
INSERT INTO `Heat Generation - Annual` SELECT GH_T.`Case`,GH_T.BaseYear,GH_T.ModelYear,GH_T.Country,GH_T.Region,GH_T.Area,GH_T.Fuel,GH_T.[Technology Category],GH_T.[Technology Type],GH_T.Technology, Sum([MWh]/1000000) AS TWh, Sum([GJ]/1000000) AS PJ FROM [Heat Generation - Term] AS GH_T GROUP BY GH_T.`Case`,GH_T.BaseYear,GH_T.ModelYear,GH_T.Country,GH_T.Region,GH_T.Area,GH_T.Fuel,GH_T.[Technology Type],GH_T.Technology;
DROP TABLE if exists `Fuel_Consumption`;
CREATE TABLE `Fuel_Consumption`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,TWh REAL,PJ REAL);
INSERT INTO Fuel_Consumption SELECT VGF_T,VGF_T2,VGF_T3,ICA.ICA3,RRRAAA.RRRAAA3,VGF_T4,IGF.IGF4,Tech.[Technology Category],Tech.[Technology Type],VGF_T5,SUM(VGF_T.level*IHOURSINST.VALUE/1000000),SUM(VGF_T.level*IHOURSINST.VALUE*3.6/1000000) FROM IGF INNER JOIN (IHOURSINST INNER JOIN (RRRAAA INNER JOIN (ICA INNER JOIN (VGF_T INNER JOIN [Technology characteristics] AS Tech ON VGF_T.VGF_T=Tech.[Case] AND VGF_T.VGF_T5=Tech.Technology) ON ICA.ICA=VGF_T.VGF_T AND ICA.ICA4=VGF_T.VGF_T4) ON RRRAAA.RRRAAA=VGF_T.VGF_T AND RRRAAA.RRRAAA4=VGF_T.VGF_T4) ON IHOURSINST.IHOURSINST=VGF_T.VGF_T AND IHOURSINST3=VGF_T.VGF_T6 AND IHOURSINST4=VGF_T.VGF_T7) ON IGF.IGF=VGF_T.VGF_T AND IGF.IGF3=VGF_T.VGF_T5 WHERE level >0 GROUP BY VGF_T,VGF_T2,VGF_T3,ICA.ICA3,RRRAAA.RRRAAA3,VGF_T4,IGF.IGF4,Tech.[Technology Category],Tech.[Technology Type],VGF_T5;
DELETE FROM Fuel_Consumption WHERE NOT ((BaseYear=ModelYear AND BaseYear<(SELECT MAX(BaseYear) FROM Fuel_Consumption)) OR (BaseYear=(SELECT MAX(BaseYear) FROM Fuel_Consumption) )) ;
DROP TABLE if exists `Emissions - Annual`;
CREATE TABLE `Emissions - Annual`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`CO2 kilotons` REAL,`CO2 megatons` REAL,`SO2 tons` REAL,`SO2 kilotons` REAL,`N2O tons` REAL,`N2O kilotons` REAL);
INSERT INTO `Emissions - Annual` SELECT DF.[Case],DF.BaseYear,DF.ModelYear,DF.Country,DF.Region,DF.Area,DF.Fuel,DF.[Technology Category],DF.[Technology Type],DF.Technology, DF.PJ*IM_CO2.value,DF.[PJ]*IM_CO2.value/1000,DF.PJ*IM_SO2.value*1000,DF.PJ*IM_SO2.value,DF.PJ*IM_N2O.value*1000,DF.PJ*IM_N2O.value FROM (([Fuel_Consumption] AS DF LEFT JOIN IM_CO2 ON DF.[Case]= IM_CO2.IM_CO2 AND DF.Technology=IM_CO2.IM_CO23) LEFT JOIN IM_SO2 ON DF.[Case]= IM_SO2.IM_SO2 AND DF.Technology=IM_SO2.IM_SO23 LEFT JOIN IM_N2O ON (DF.[Case]= IM_N2O.IM_N2O AND DF.Technology=IM_N2O.IM_N2O3)) GROUP BY DF.[Case],DF.BaseYear,DF.ModelYear,DF.Country,DF.Region,DF.Area,DF.Fuel,DF.[Technology Category],DF.[Technology Type],DF.Technology;
DROP TABLE if exists `Heat Storage volume`;
CREATE TABLE `Heat Storage volume`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,Technology,`Season`,`Term`,`MWh` REAL,`GJ` REAL);
INSERT INTO `Heat Storage volume` SELECT VHSTOVOLT.VHSTOVOLT, VHSTOVOLT.VHSTOVOLT2, VHSTOVOLT.VHSTOVOLT3,ICA.ICA3, RRRAAA.RRRAAA3, VHSTOVOLT.VHSTOVOLT4, VHSTOVOLT.VHSTOVOLT5, VHSTOVOLT.VHSTOVOLT6, VHSTOVOLT.VHSTOVOLT7,Sum(VHSTOVOLT.level), Sum(VHSTOVOLT.level)*3.6 FROM ICA INNER JOIN (RRRAAA INNER JOIN VHSTOVOLT ON (RRRAAA.RRRAAA4 = VHSTOVOLT.VHSTOVOLT4) AND (RRRAAA.RRRAAA = VHSTOVOLT.VHSTOVOLT)) ON (ICA.ICA4 = VHSTOVOLT.VHSTOVOLT4) AND (ICA.ICA = VHSTOVOLT.VHSTOVOLT) GROUP BY VHSTOVOLT.VHSTOVOLT, VHSTOVOLT.VHSTOVOLT2, VHSTOVOLT.VHSTOVOLT3, ICA.ICA3, RRRAAA.RRRAAA3, VHSTOVOLT.VHSTOVOLT4, VHSTOVOLT.VHSTOVOLT5, VHSTOVOLT.VHSTOVOLT6,VHSTOVOLT.VHSTOVOLT7;
DELETE FROM [Heat storage volume] WHERE NOT ((BaseYear=ModelYear AND BaseYear<(SELECT MAX(BaseYear) FROM [Heat storage volume])) OR (BaseYear=(SELECT MAX(BaseYear) FROM [Heat storage volume])));
DELETE FROM 'Heat Storage volume' WHERE NOT (COUNTRY IN ( 'DENMARK','ESTONIA','NORWAY','FINLAND','GERMANY','NETHERLANDS','SWEDEN','UNITED_KINGDOM','LATVIA','LITHUANIA','POLAND','BELGIUM','FRANCE'));
DROP TABLE if exists `Weekly Hydro Storage Volume`;
CREATE TABLE `Weekly Hydro Storage Volume`(`Case` TEXT, `BaseYear`TEXT, `ModelYear` TEXT,`Country` TEXT, `Region` TEXT, `Area` TEXT,`Week` TEXT, `MWh` REAL);
INSERT INTO `Weekly Hydro Storage Volume`(`Case`,BaseYear,ModelYear,Country, Region,Area,Week,MWh) SELECT VHYRS_S.VHYRS_S, VHYRS_S.VHYRS_S2,VHYRS_S.VHYRS_S3, ICA.ICA3,RRRAAA.RRRAAA3, VHYRS_S.VHYRS_S4, VHYRS_S.VHYRS_S5, VHYRS_S.level FROM (VHYRS_S INNER JOIN ICA ON VHYRS_S.VHYRS_S4 = ICA.ICA4) INNER JOIN RRRAAA ON VHYRS_S.VHYRS_S4 = RRRAAA.RRRAAA4;
DELETE FROM [Weekly Hydro Storage Volume] WHERE NOT ((BaseYear=ModelYear AND BaseYear<(SELECT MAX(BaseYear) FROM [Weekly Hydro Storage Volume])) OR (BaseYear=(SELECT MAX(BaseYear) FROM [Weekly Hydro Storage Volume])));
DROP TABLE if exists `Cap_Invest_MW`;
CREATE TABLE `Cap_Invest_MW` (`Case`,BaseYear,ModelYear,Country,Region,Area,Fuel,`Technology Category`,`Technology Type`,Technology,`MW` REAL);
INSERT INTO `Cap_Invest_MW` (`Case`,BaseYear,ModelYear,Country,Region,Area,Fuel,`Technology Category`,`Technology Type`,Technology,`MW`) SELECT VGKN.VGKN,VGKN.VGKN2,VGKN.VGKN3,ICA.ICA3,RRRAAA.RRRAAA3,VGKN.VGKN4,IGF.IGF4,Tech.[Technology Category],Tech.[Technology Type],VGKN.VGKN5,VGKN.level FROM [Technology characteristics] AS Tech INNER JOIN (IGF INNER JOIN (ICA INNER JOIN (RRRAAA INNER JOIN VGKN ON RRRAAA.RRRAAA=VGKN.VGKN AND RRRAAA.RRRAAA4=VGKN.VGKN4) ON ICA.ICA4=VGKN.VGKN4 AND VGKN.VGKN=ICA.ICA) ON IGF.IGF3=VGKN.VGKN5 AND VGKN.VGKN=IGF.IGF) ON TECH.[Case]=ICA.ICA AND TECH.Technology=VGKN.VGKN5 WHERE VGKN.level > 0 GROUP BY VGKN.VGKN,VGKN.VGKN2,VGKN.VGKN3,ICA.ICA3,RRRAAA.RRRAAA3,VGKN.VGKN4,IGF.IGF4,Tech.[Technology Category],Tech.[Technology Type],VGKN.VGKN5,VGKN.level;
DELETE FROM [Cap_Invest_MW] WHERE NOT ((BaseYear=ModelYear AND BaseYear<(SELECT MAX(BaseYear) FROM [Cap_Invest_MW])) OR (BaseYear=(SELECT MAX(BaseYear) FROM [Cap_Invest_MW]))AND ModelYear>=BaseYear);
UPDATE [Cap_Invest_MW] SET MW = MW/(SELECT Tech.[Time to unload storage] FROM [Technology characteristics] AS Tech INNER JOIN Cap_Invest_MW ON Tech.[Case]=Cap_Invest_MW.[Case] AND Tech.[Technology]=Cap_Invest_MW.[Technology] AND Cap_Invest_MW.[Technology Category] ='Storage') WHERE Cap_Invest_MW.[Technology Category] ='Storage';
DROP TABLE if exists `Exo_gen_cap_MW`;
CREATE TABLE `Exo_gen_cap_MW`(`Case`,`Year`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Capacity Type`,`Technology`,`MW` REAL);
INSERT INTO `Exo_gen_cap_MW` SELECT GKFX.GKFX,GKFX.GKFX3,ICA.ICA3,RRRAAA.RRRAAA3,GKFX.GKFX4,Tech.[Fuel Type],Tech.[Technology Category],Tech.[Technology Type],'Exogenous',GKFX.GKFX5,Sum(GKFX.value) FROM [Technology characteristics] AS Tech INNER JOIN (RRRAAA INNER JOIN (ICA INNER JOIN (Y INNER JOIN GKFX ON (Y.Y3 = GKFX.GKFX3) AND (Y.Y = GKFX.GKFX)) ON (ICA.ICA4 = GKFX.GKFX4) AND (ICA.ICA = GKFX.GKFX)) ON (RRRAAA.RRRAAA4 = GKFX.GKFX4) AND (RRRAAA.RRRAAA = GKFX.GKFX))  ON TECH.[Case]=ICA.ICA AND TECH.Technology=GKFX.GKFX5 GROUP BY GKFX.GKFX,GKFX.GKFX3,ICA.ICA3,RRRAAA.RRRAAA3,GKFX.GKFX4,GKFX.GKFX5;
DROP TABLE if exists `Endo_gen_cap_MW`;
CREATE TABLE `Endo_gen_cap_MW`(`Case`,BaseYear,ModelYear,Country,Region,Area,Fuel,`Technology Category`,`Technology Type`,`Capacity Type`,Technology,`MW` REAL);
INSERT INTO `Endo_gen_cap_MW` SELECT VGKNACCUMNET.VGKNACCUMNET,VGKNACCUMNET.VGKNACCUMNET2,VGKNACCUMNET.VGKNACCUMNET3,ICA.ICA3,RRRAAA.RRRAAA3,VGKNACCUMNET.VGKNACCUMNET4,Tech.[Fuel Type],Tech.[Technology category],Tech.[Technology Type],'Endogenous',VGKNACCUMNET.VGKNACCUMNET5,VGKNACCUMNET.level FROM [Technology characteristics] AS Tech INNER JOIN (ICA INNER JOIN (RRRAAA INNER JOIN VGKNACCUMNET ON RRRAAA.RRRAAA =VGKNACCUMNET.VGKNACCUMNET AND RRRAAA.RRRAAA4=VGKNACCUMNET.VGKNACCUMNET4) ON ICA.ICA4=VGKNACCUMNET.VGKNACCUMNET4 AND VGKNACCUMNET.VGKNACCUMNET=ICA.ICA) ON TECH.[Case]=ICA.ICA AND TECH.Technology=VGKNACCUMNET.VGKNACCUMNET5 WHERE VGKNACCUMNET.level>0 AND VGKNACCUMNET.VGKNACCUMNET2<=VGKNACCUMNET.VGKNACCUMNET3 GROUP BY VGKNACCUMNET.VGKNACCUMNET,VGKNACCUMNET.VGKNACCUMNET2,VGKNACCUMNET.VGKNACCUMNET3,ICA.ICA3,RRRAAA.RRRAAA3,VGKNACCUMNET.VGKNACCUMNET4,VGKNACCUMNET.VGKNACCUMNET5;
DELETE FROM [Endo_gen_cap_MW] WHERE NOT ((BaseYear=ModelYear AND BaseYear<(SELECT MAX(BaseYear) FROM [Endo_gen_cap_MW])) OR (BaseYear=(SELECT MAX(BaseYear) FROM [Endo_gen_cap_MW])) AND ModelYear>=BaseYear);
DROP VIEW if exists `Cap_Tot`;
CREATE VIEW Cap_Tot(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Capacity Type`,`Technology`,`MW`) AS SELECT [Case],BaseYear,ModelYear,Country,Region,Area,Fuel,[Technology Category],[Technology Type],[Capacity Type],Technology,MW FROM [Endo_gen_cap_MW] UNION SELECT Exo.[Case],Endo.Baseyear,Exo.Year,Exo.Country,Exo.Region,Exo.Area,Exo.Fuel,Exo.[Technology Category],Exo.[Technology Type],Exo.[Capacity Type],Exo.Technology,Exo.MW FROM ([Exo_gen_cap_MW] AS Exo INNER JOIN Y ON Y.Y=Exo.[Case] AND Y.Y3=Exo.Year) LEFT JOIN [Endo_gen_cap_MW] AS Endo ON Exo.Year=Endo.ModelYear AND Exo.[Case]=Endo.[Case];
DROP TABLE if exists `Storage capacity`;
CREATE TABLE `Storage capacity`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Type`,`Capacity Type`,`Technology`,`MWh` REAL,`GWh` REAL);
INSERT INTO `Storage capacity` SELECT [Case],BaseYear,ModelYear,Country,Region,Area,Fuel,[Technology Type],[Capacity Type],Technology,MW,MW/1000 FROM Cap_Tot WHERE [Technology Category]='Storage';
UPDATE [Storage capacity] SET MWh =( SELECT VGKNACCUMNET.level FROM VGKNACCUMNET WHERE VGKNACCUMNET.VGKNACCUMNET=[Storage capacity].[Case] AND VGKNACCUMNET.VGKNACCUMNET2=[Storage capacity].[BaseYear] AND VGKNACCUMNET.VGKNACCUMNET3=[Storage capacity].[ModelYear] AND VGKNACCUMNET.VGKNACCUMNET4=[Storage capacity].[Area] AND VGKNACCUMNET.VGKNACCUMNET5=[Storage capacity].[Technology] AND [Storage capacity].[Capacity Type]='Endogenous') , MWh =( SELECT GKFX.value FROM GKFX WHERE GKFX.GKFX=[Storage capacity].[Case] AND GKFX.GKFX3=[Storage capacity].[BaseYear] AND GKFX.GKFX3=[Storage capacity].[ModelYear] AND GKFX.GKFX4=[Storage capacity].[Area] AND GKFX.GKFX5=[Storage capacity].[Technology] AND [Storage capacity].[Capacity Type]='Exogenous')WHERE [Storage capacity].[Capacity Type]='Exogenous';
DROP TABLE if exists `Electricity generation capacity Total`;
CREATE TABLE `Electricity generation capacity Total`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Capacity Type`,`Technology`,`MW` REAL,`GW` REAL);
INSERT INTO `Electricity generation capacity Total` SELECT [Case],BaseYear,ModelYear,Country,Region,Area,Fuel,[Technology Category],[Technology Type],[Capacity Type],Technology,MW,MW/1000 FROM Cap_Tot WHERE [Technology Type] IN ('Condensing', 'Backpressure', 'Extraction','Electricity storage - Short term storage capacity','Electricity storage - Long term storage capacity','Hydro reservoir','Hydro ROR','Solar PV' ,'Wind' ,'Wave');
UPDATE [Electricity generation capacity Total] SET MW = MW/(SELECT [Technology characteristics].[Time to unload storage] FROM [Technology characteristics] WHERE [Technology characteristics].[Case]=[Electricity generation capacity Total].[Case] AND [Technology characteristics].[Technology]=[Electricity generation capacity Total].[Technology] AND [Electricity generation capacity Total].[Technology Category] ='Storage'), GW = (MW*0.0001)/(SELECT [Technology characteristics].[Time to unload storage] FROM [Technology characteristics] WHERE [Technology characteristics].[Case]=[Electricity generation capacity Total].[Case] AND [Technology characteristics].[Technology]=[Electricity generation capacity Total].[Technology] AND [Electricity generation capacity Total].[Technology Category] ='Storage') WHERE [Electricity generation capacity Total].[Technology Category] ='Storage';
DROP TABLE if exists `Heat generation capacity Total`;
CREATE TABLE `Heat generation capacity Total`(`Case`,`ModelYear`,`BaseYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Capacity Type`,`Technology`, `MW` REAL, `GW` REAL);
INSERT INTO `Heat generation capacity Total` SELECT [Case],BaseYear,ModelYear,Country,Region,Area,Fuel,[Technology Category],[Technology Type],`Capacity Type`,Technology,MW,MW/1000 FROM Cap_Tot WHERE [Technology Type] IN ('Backpressure','Extraction','Boiler','Electricity to heat','Heat storage - Short term storage capacity','Heat storage - Long term storage capacity','Solar heat') ;
UPDATE `Heat generation capacity Total` SET MW = CASE WHEN [Technology Type]= ('Backpressure') THEN MW/ (SELECT Tech.[CHP CB-value] FROM [Technology characteristics] AS TECH INNER JOIN [Heat generation capacity Total] AS HCAP ON Tech.Technology=HCAP.[Technology] AND Tech.[Case]=HCAP.[Case]) WHEN [Technology Type]= ('Extraction') THEN MW/ (SELECT Tech.[CHP CB-value]+Tech.[CHP CV-value] FROM [Technology characteristics] AS TECH INNER JOIN [Heat generation capacity Total] AS HCAP ON Tech.Technology=HCAP.[Technology] AND Tech.[Case]=HCAP.[Case]) ELSE MW END, GW=CASE WHEN [Technology Type]= ('Backpressure') THEN GW/ (SELECT Tech.[CHP CB-value] FROM [Technology characteristics] AS TECH INNER JOIN [Heat generation capacity Total] AS HCAP ON Tech.Technology=HCAP.[Technology] AND Tech.[Case]=HCAP.[Case]) WHEN [Technology Type]= ('Extraction') THEN GW/ (SELECT Tech.[CHP CB-value]+Tech.[CHP CV-value] FROM [Technology characteristics] AS TECH INNER JOIN [Heat generation capacity Total] AS HCAP ON Tech.Technology=HCAP.[Technology] AND Tech.[Case]=HCAP.[Case]) ELSE GW END;
UPDATE [Heat generation capacity Total] SET MW = MW/(SELECT [Technology characteristics].[Time to unload storage] FROM [Technology characteristics] WHERE [Technology characteristics].[Case]=[Heat generation capacity Total].[Case] AND [Technology characteristics].[Technology]=[Heat generation capacity Total].[Technology] AND [Heat generation capacity Total].[Technology Category] ='Storage'), GW = (MW*0.0001)/(SELECT [Technology characteristics].[Time to unload storage] FROM [Technology characteristics] WHERE [Technology characteristics].[Case]=[Heat generation capacity Total].[Case] AND [Technology characteristics].[Technology]=[Heat generation capacity Total].[Technology] AND [Heat generation capacity Total].[Technology Category] ='Storage') WHERE [Heat generation capacity Total].[Technology Category] ='Storage';
DROP TABLE if exists `Electricity Demand - Term`;
CREATE TABLE `Electricity Demand - Term`(`Case` TEXT, Year TEXT, Country TEXT, Region TEXT, UserGroup TEXT, Season TEXT, Term TEXT, MW REAL, MWh REAL);
INSERT INTO `Electricity Demand - Term`(`Case`,Year,Country,Region,UserGroup,Season,Term,MW,MWh)  SELECT DE.DE AS [Case], DE.DE3 AS [Year], CCCRRR.CCCRRR3 AS Country, DE.DE4 AS Region, DE.DE5 AS UserGroup, DE_VAR_T.DE_VAR_T5 AS Season, DE_VAR_T.DE_VAR_T6 AS Timestep, Sum([DE].[value]*[DE_VAR_T].[value]/[IDE_SUMST].[value]) AS MW, Sum([DE].[value]*[DE_VAR_T].[value]/[IDE_SUMST].[value]*[IHOURSINST].[value]) AS MWh  FROM IHOURSINST INNER JOIN (Y INNER JOIN ((DE_VAR_T INNER JOIN (DE INNER JOIN CCCRRR ON (DE.DE = CCCRRR.CCCRRR) AND (DE.DE4 = CCCRRR.CCCRRR4)) ON (DE_VAR_T.DE_VAR_T = DE.DE) AND (DE_VAR_T.DE_VAR_T3 = DE.DE4) AND (DE_VAR_T.DE_VAR_T4 = DE.DE5))  INNER JOIN IDE_SUMST ON (DE.DE = IDE_SUMST.IDE_SUMST) AND (DE.DE5 = IDE_SUMST.IDE_SUMST4) AND  (DE_VAR_T.DE_VAR_T3 = IDE_SUMST.IDE_SUMST3) AND  (DE_VAR_T.DE_VAR_T4 = IDE_SUMST.IDE_SUMST4)) ON (Y.Y = DE.DE) AND (Y.Y3 = DE.DE3)) ON (DE_VAR_T.DE_VAR_T6 = IHOURSINST.IHOURSINST4) AND (DE_VAR_T.DE_VAR_T5 = IHOURSINST.IHOURSINST3) AND (IHOURSINST.IHOURSINST = DE_VAR_T.DE_VAR_T)  GROUP BY DE.DE, DE.DE3, CCCRRR.CCCRRR3, DE.DE4, DE.DE5, DE_VAR_T.DE_VAR_T5, DE_VAR_T.DE_VAR_T6;
DROP TABLE if exists `Electricity Demand - Annual`;
CREATE TABLE `Electricity Demand - Annual`(`Case` TEXT, Year TEXT, Country TEXT, Region TEXT,UserGroup TEXT, TWh REAL, GWh REAL);
INSERT INTO `Electricity Demand - Annual`(`Case` , Year , Country , Region, UserGroup, TWh , GWh) SELECT [Electricity demand - Term].`Case`, [Electricity demand - Term].Year, [Electricity demand - Term].Country, [Electricity demand - Term].Region, [Electricity demand - Term].UserGroup,Sum([MWH])/1000000 AS TWh, Sum([MWH])/1000 AS GWh FROM [Electricity demand - Term] GROUP BY [Electricity demand - Term].`Case`, [Electricity demand - Term].Year, [Electricity demand - Term].Country, [Electricity demand - Term].Region,[Electricity demand - Term].UserGroup;
DROP TABLE if exists `Heat Demand - Term`;
CREATE TABLE `Heat Demand - Term`(`Case` TEXT, Year TEXT, Country TEXT, Region TEXT, Area TEXT,UserGroup TEXT,Season TEXT, Term TEXT, MW REAL, MWh REAL, GJ REAL);
INSERT INTO `Heat Demand - Term`(`Case`,Year,Country,Region,Area,UserGroup,Season,Term,MW,MWh,GJ)   SELECT DH.DH AS [Case], DH.DH3 AS [Year], ICA.ICA3 AS Country, RRRAAA.RRRAAA3 AS Region, DH.DH4 AS Area,DH.DH5 AS UserGroup, DH_VAR_T.DH_VAR_T5 AS Season, DH_VAR_T.DH_VAR_T6 AS Term, Sum([DH].[value]*[DH_VAR_T].[value]/[IDH_SUMST].[value]) AS MW, Sum([DH].[value]*[DH_VAR_T].[value]/[IDH_SUMST].[value]*[IHOURSINST].[value]) AS MWh, Sum([DH].[value]*[DH_VAR_T].[value]/[IDH_SUMST].[value]*[IHOURSINST].[value])*3.6 AS GJ  FROM IHOURSINST INNER JOIN ((C INNER JOIN (ICA INNER JOIN (Y INNER JOIN (DH INNER JOIN (IDH_SUMST INNER JOIN DH_VAR_T ON (IDH_SUMST.IDH_SUMST3 = DH_VAR_T.DH_VAR_T3) and (IDH_SUMST.IDH_SUMST4 = DH_VAR_T.DH_VAR_T4)) ON (DH.DH = IDH_SUMST.IDH_SUMST) AND (DH.DH = DH_VAR_T.DH_VAR_T) AND (DH.DH4 = DH_VAR_T.DH_VAR_T3) AND (DH.DH5 = DH_VAR_T.DH_VAR_T4)) ON (Y.Y = DH.DH) AND (Y.Y3 = DH.DH3)) ON (ICA.ICA = DH.DH) AND (ICA.ICA4 = DH.DH4)) ON (C.C = DH.DH) AND (C.C3 = ICA.ICA3))  INNER JOIN RRRAAA ON (DH.DH4 = RRRAAA.RRRAAA4) AND (DH.DH = RRRAAA.RRRAAA)) ON (DH_VAR_T.DH_VAR_T6 = IHOURSINST.IHOURSINST4) AND (DH_VAR_T.DH_VAR_T5 = IHOURSINST.IHOURSINST3) AND (IHOURSINST.IHOURSINST = DH_VAR_T.DH_VAR_T)  GROUP BY DH.DH, DH.DH3, ICA.ICA3, RRRAAA.RRRAAA3, DH.DH4,DH.DH5, DH_VAR_T.DH_VAR_T4, DH_VAR_T.DH_VAR_T;
DROP TABLE if exists `Heat Demand - Annual`;
CREATE TABLE `Heat Demand - Annual`(`Case` TEXT, Year TEXT, Country TEXT, Region TEXT, UserGroup TEXT, Area TEXT, TWh REAL, PJ REAL);
INSERT INTO `Heat Demand - Annual`(`Case`, Year, Country, Region,UserGroup,Area,TWh,PJ) SELECT [Heat demand - Term].`Case`, [Heat demand - Term].Year, [Heat demand - Term].Country, [Heat demand - Term].Region,[Heat demand - Term].UserGroup, [Heat demand - Term].Area, Sum([MWh]/1000000) AS TWh, Sum([MWh]/1000000)*3.6 AS PJ FROM [Heat demand - Term] GROUP BY [Heat demand - Term].`Case`, [Heat demand - Term].Year, [Heat demand - Term].Country, [Heat demand - Term].Region,[Heat demand - Term].UserGroup, [Heat demand - Term].Area;
DROP TABLE if exists `Transmission Investments`;
CREATE TABLE `Transmission Investments`(`Case` TEXT,BaseYear TEXT,ModelYear TEXT,`Export Country` TEXT,`Import Country` TEXT,`Export Region` TEXT,`Import Region` TEXT,`Capacity Type` TEXT,MW REAL);
INSERT INTO `Transmission Investments`(`Case`,BaseYear,ModelYear,`Export Country`,`Import Country`,`Export Region`,`Import Region`,MW) SELECT VXKN.VXKN,VXKN.VXKN2,VXKN.VXKN3,CR1.CCCRRR3,CR2.CCCRRR3,VXKN.VXKN4,VXKN.VXKN5,VXKN.level FROM CCCRRR AS CR2 INNER JOIN (VXKN INNER JOIN CCCRRR AS CR1 ON VXKN.VXKN=CR1.CCCRRR AND VXKN.VXKN4=CR1.CCCRRR4) ON VXKN.VXKN=CR2.CCCRRR AND VXKN.VXKN5=CR2.CCCRRR4 WHERE VXKN.level>0;
DELETE FROM [Transmission Investments] WHERE NOT ((BaseYear=ModelYear AND BaseYear<(SELECT MAX(BaseYear) FROM [Transmission Investments])) OR (BaseYear=(SELECT MAX(BaseYear) FROM [Transmission Investments])));
DROP TABLE if exists `Transmission Capacity`;
CREATE TABLE `Transmission Capacity`(`Case` TEXT,BaseYear TEXT,ModelYear TEXT, `Export Region` TEXT,`Import Region` TEXT, `Capacity Type` TEXT,MW REAL);
INSERT INTO `Transmission Capacity`(`Case`,BaseYear,ModelYear,`Export Region`,`Import Region`,`Capacity Type`,MW) SELECT VXKNACCUMNET.VXKNACCUMNET,VXKNACCUMNET.VXKNACCUMNET2,VXKNACCUMNET.VXKNACCUMNET3,VXKNACCUMNET.VXKNACCUMNET4,VXKNACCUMNET.VXKNACCUMNET5 ,'Endogenous',VXKNACCUMNET.level FROM VXKNACCUMNET UNION SELECT XKFX.XKFX,XKFX.XKFX3,XKFX.XKFX3, XKFX.XKFX4, XKFX.XKFX5,'Exogenous',XKFX.value FROM XKFX INNER JOIN Y ON Y.Y3=XKFX.XKFX3 UNION SELECT DISTINCT FB_ACRAM.FB_ACRAM,Y.Y3,Y.Y3, LINESRRR.LINESRRR5,LINESRRR.LINESRRR4,'Exogenous AC', FB_ACRAM.value FROM LINESRRR, Y JOIN FB_ACRAM ON FB_ACRAM.FB_ACRAM4=LINESRRR.LINESRRR3 AND FB_ACRAM.FB_ACRAM=LINESRRR.LINESRRR UNION SELECT DISTINCT FB_ACRAM.FB_ACRAM,Y.Y3,Y.Y3, LINESRRR.LINESRRR4,LINESRRR.LINESRRR5,'Exogenous AC', FB_ACRAM.value FROM LINESRRR, Y JOIN FB_ACRAM ON FB_ACRAM.FB_ACRAM4=LINESRRR.LINESRRR3 AND FB_ACRAM.FB_ACRAM=LINESRRR.LINESRRR;
DELETE FROM [Transmission Capacity] WHERE NOT ((BaseYear=ModelYear));
DROP TABLE if exists `El Transmission between regions net - Term`;
CREATE TABLE `El Transmission between regions net - Term`(`Case` TEXT, BaseYear TEXT,ModelYear TEXT, Source TEXT, Destination TEXT, Season TEXT, Term TEXT, GW REAL, `Capacity Type` TEXT);
INSERT INTO `El Transmission between regions net - Term`(`Case`,BaseYear,ModelYear,Source,Destination, Season, Term,GW, `Capacity Type`) SELECT VX_T.VX_T, VX_T.VX_T2, VX_T.VX_T3, VX_T.VX_T4,VX_T.VX_T5, VX_T.VX_T6,VX_T.VX_T7, Sum(VX_T.level-VX_T_1.level)/1000, 'HVDC Flows' FROM VX_T INNER JOIN VX_T AS VX_T_1 ON (VX_T.VX_T6 = VX_T_1.VX_T6) AND (VX_T.VX_T7 = VX_T_1.VX_T7) AND (VX_T.VX_T4 = VX_T_1.VX_T5) AND (VX_T.VX_T5 = VX_T_1.VX_T4) AND (VX_T.VX_T3 = VX_T_1.VX_T3) AND (VX_T.VX_T2 = VX_T_1.VX_T2) AND (VX_T.VX_T = VX_T_1.VX_T) GROUP BY VX_T.VX_T, VX_T.VX_T2, VX_T.VX_T3,  VX_T.VX_T4, VX_T.VX_T5, VX_T.VX_T6, VX_T.VX_T7 UNION SELECT VX_AC_T.VX_AC_T, VX_AC_T.VX_AC_T2, VX_AC_T.VX_AC_T3, VX_AC_T.VX_AC_T4,VX_AC_T.VX_AC_T5, VX_AC_T.VX_AC_T6,VX_AC_T.VX_AC_T7, Sum(VX_AC_T.level-VX_AC_T_1.level)/1000, 'AC Flows' FROM VX_AC_T INNER JOIN VX_AC_T AS VX_AC_T_1 ON (VX_AC_T.VX_AC_T6 = VX_AC_T_1.VX_AC_T6) AND (VX_AC_T.VX_AC_T7 = VX_AC_T_1.VX_AC_T7) AND (VX_AC_T.VX_AC_T4 = VX_AC_T_1.VX_AC_T5) AND (VX_AC_T.VX_AC_T5 = VX_AC_T_1.VX_AC_T4) AND (VX_AC_T.VX_AC_T3 = VX_AC_T_1.VX_AC_T3) AND (VX_AC_T.VX_AC_T2 = VX_AC_T_1.VX_AC_T2) AND (VX_AC_T.VX_AC_T = VX_AC_T_1.VX_AC_T) GROUP BY VX_AC_T.VX_AC_T, VX_AC_T.VX_AC_T2, VX_AC_T.VX_AC_T3,  VX_AC_T.VX_AC_T4, VX_AC_T.VX_AC_T5, VX_AC_T.VX_AC_T6, VX_AC_T.VX_AC_T7;
DELETE FROM [El Transmission between regions net - Term] WHERE NOT ((BaseYear=ModelYear AND BaseYear<(SELECT MAX(BaseYear) FROM [El Transmission between regions net - Term])) OR (BaseYear=(SELECT MAX(BaseYear) FROM [El Transmission between regions net - Term])));
DROP TABLE if exists `El Transmission between Countries`;
CREATE TABLE `El Transmission between Countries`(`Case` TEXT, BaseYear TEXT,ModelYear TEXT,Country_Export TEXT, Region_Export TEXT,Country_Import TEXT,Region_Import TEXT,`Capacity Type` Text,GWh REAL,M€ REAL);
INSERT INTO `El Transmission between Countries`(`Case`,BaseYear,ModelYear,Country_Export,Region_Export,Country_Import,Region_Import,`Capacity Type`,GWh,M€)SELECT VX_T.VX_T, VX_T.VX_T2,VX_T.VX_T3,CCCRRR.CCCRRR3,VX_T.VX_T4, CCCRRR_1.CCCRRR3, VX_T.VX_T5,'HVDC Flows', Sum(VX_T.level*IHOURSINST.value)/1000, Sum(VX_T.level*IHOURSINST.value*(EPR.[OMONEY/MWh] - EPR_1.[OMONEY/MWh]))/1000000 FROM Electricity_price AS EPR INNER JOIN (Electricity_price AS EPR_1 INNER JOIN (CCCRRR INNER JOIN (CCCRRR AS CCCRRR_1 INNER JOIN (VX_T  INNER JOIN IHOURSINST ON (VX_T.VX_T7 = IHOURSINST.IHOURSINST4) AND (VX_T.VX_T6 = IHOURSINST.IHOURSINST3) AND (VX_T.VX_T = IHOURSINST.IHOURSINST)) ON (CCCRRR_1.CCCRRR4 = VX_T.VX_T5) AND (CCCRRR_1.CCCRRR = VX_T.VX_T)) ON (CCCRRR.CCCRRR4 = VX_T.VX_T4) AND (CCCRRR.CCCRRR = VX_T.VX_T)) ON EPR_1.[Case]=VX_T.VX_T AND EPR_1.BaseYear=VX_T.VX_T2 AND EPR_1.ModelYear=VX_T.VX_T3 AND EPR_1.Region = VX_T.VX_T4 AND EPR_1.Season = VX_T.VX_T6 AND EPR_1.Term = VX_T.VX_T7) ON EPR.[Case]=VX_T.VX_T AND EPR.BaseYear=VX_T.VX_T2 AND EPR.ModelYear=VX_T.VX_T3 AND EPR.Region = VX_T.VX_T5 AND Epr.Season = VX_T.VX_T6 AND EPR.Term = VX_T.VX_T7 GROUP BY VX_T.VX_T,VX_T.VX_T2,VX_T.VX_T3,CCCRRR.CCCRRR3,VX_T.VX_T4,CCCRRR_1.CCCRRR3,VX_T.VX_T5 UNION SELECT VX_AC_T.VX_AC_T, VX_AC_T.VX_AC_T2,VX_AC_T.VX_AC_T3,CCCRRR.CCCRRR3,VX_AC_T.VX_AC_T4, CCCRRR_1.CCCRRR3, VX_AC_T.VX_AC_T5,'AC Flows', Sum(VX_AC_T.level*IHOURSINST.value)/1000, Sum(VX_AC_T.level*IHOURSINST.value*(EPR.[OMONEY/MWh] - EPR_1.[OMONEY/MWh]))/1000000 FROM Electricity_price AS EPR INNER JOIN (Electricity_price AS EPR_1 INNER JOIN (CCCRRR INNER JOIN (CCCRRR AS CCCRRR_1 INNER JOIN (VX_AC_T  INNER JOIN IHOURSINST ON (VX_AC_T.VX_AC_T7 = IHOURSINST.IHOURSINST4) AND (VX_AC_T.VX_AC_T6 = IHOURSINST.IHOURSINST3) AND (VX_AC_T.VX_AC_T = IHOURSINST.IHOURSINST)) ON (CCCRRR_1.CCCRRR4 = VX_AC_T.VX_AC_T5) AND (CCCRRR_1.CCCRRR = VX_AC_T.VX_AC_T)) ON (CCCRRR.CCCRRR4 = VX_AC_T.VX_AC_T4) AND (CCCRRR.CCCRRR = VX_AC_T.VX_AC_T)) ON EPR_1.[Case]=VX_AC_T.VX_AC_T AND EPR_1.BaseYear=VX_AC_T.VX_AC_T2 AND EPR_1.ModelYear=VX_AC_T.VX_AC_T3 AND EPR_1.Region = VX_AC_T.VX_AC_T4 AND EPR_1.Season = VX_AC_T.VX_AC_T6 AND EPR_1.Term = VX_AC_T.VX_AC_T7) ON EPR.[Case]=VX_AC_T.VX_AC_T AND EPR.BaseYear=VX_AC_T.VX_AC_T2 AND EPR.ModelYear=VX_AC_T.VX_AC_T3 AND EPR.Region = VX_AC_T.VX_AC_T5 AND Epr.Season = VX_AC_T.VX_AC_T6 AND EPR.Term = VX_AC_T.VX_AC_T7 GROUP BY VX_AC_T.VX_AC_T,VX_AC_T.VX_AC_T2,VX_AC_T.VX_AC_T3,CCCRRR.CCCRRR3,VX_AC_T.VX_AC_T4,CCCRRR_1.CCCRRR3,VX_AC_T.VX_AC_T5;
DROP TABLE if exists `Fuel price`;
CREATE TABLE `Fuel price`(`Case` TEXT, Year TEXT, Country TEXT, Region TEXT, Area TEXT, Fuel TEXT, `€/MWh` REAL, `€/GJ` REAL);
INSERT INTO `Fuel price`(`Case`,Year,Country,Region,Area, Fuel,`€/MWh`, `€/GJ`)   SELECT FUELPRICE.FUELPRICE AS [Case], FUELPRICE.FUELPRICE3 AS [Year], ICA.ICA3 AS Country, RRRAAA.RRRAAA3 AS Region, FUELPRICE.FUELPRICE4 AS Area,FUELPRICE.FUELPRICE5 AS Fuel, [FUELPRICE].[value]*3.6 AS `€/MWh`, [FUELPRICE].[value] AS `€/GJ`  FROM ICA INNER JOIN (FUELPRICE INNER JOIN RRRAAA ON (FUELPRICE.FUELPRICE4 = RRRAAA.RRRAAA4) AND (FUELPRICE.FUELPRICE = RRRAAA.RRRAAA)) ON (FUELPRICE.FUELPRICE4 = ICA.ICA4) AND (FUELPRICE.FUELPRICE = ICA.ICA) GROUP BY FUELPRICE.FUELPRICE, FUELPRICE.FUELPRICE3, ICA.ICA3, RRRAAA.RRRAAA3, FUELPRICE.FUELPRICE4,FUELPRICE.FUELPRICE5;
DROP TABLE if exists `Emission Policy`;
CREATE TABLE `Emission Policy`(`Case`,Year,Policy,Location,`Value` REAL);
INSERT INTO [Emission Policy] SELECT M_POL,M_POL3,CASE WHEN M_POL4='TAX_CO2' THEN 'CO2 Tax' WHEN M_POL4='TAX_SO2' THEN 'SO2 Tax' WHEN M_POL4='TAX_NOx' THEN 'NOx Tax' END,M_POL5, sum(M_POL.value*OMONEY.value) FROM M_POL INNER JOIN OMONEY ON M_POL.M_POL=OMONEY.OMONEY WHERE M_POL4 IN ('TAX_SO2','TAX_NOx','TAX_CO2') GROUP BY M_POL,M_POL3,M_POL4,M_POL5 UNION SELECT M_POL,M_POL3,CASE WHEN M_POL4='LIM_CO2' THEN 'CO2 Limit' WHEN M_POL4='LIM_SO2' THEN 'SO2 Limit' WHEN M_POL4='LIM_NOx' THEN 'NOx Limit' END, M_POL5, sum(M_POL.value*OMONEY.value) FROM M_POL INNER JOIN OMONEY ON M_POL.M_POL=OMONEY.OMONEY WHERE M_POL4 IN ('LIM_SO2','LIM_NOx','LIM_CO2') GROUP BY M_POL,M_POL3,M_POL4,M_POL5;
DROP TABLE if exists `Heat Transfer - Time`;
CREATE TABLE `Heat Transfer - Time`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Export Area`,`Import Area`,`Season` TEXT, `Term` TEXT,`MW` REAL, `MWh` REAL, `GJ` REAL);
INSERT INTO `Heat Transfer - Time` SELECT VXH_T.VXH_T,VXH_T.VXH_T2,VXH_T.VXH_T3,ICA.ICA3,RRRAAA.RRRAAA3,VXH_T.VXH_T4,VXH_T.VXH_T5,VXH_T.VXH_T6,VXH_T.VXH_T7,VXH_T.LEVEL,IHOURSINST.VALUE*VXH_T.LEVEL,3.6*IHOURSINST.VALUE*VXH_T.LEVEL FROM IHOURSINST INNER JOIN (RRRAAA INNER JOIN        (VXH_T INNER JOIN ICA ON ICA.ICA=VXH_T.VXH_T AND ICA.ICA4=VXH_T.VXH_T4) ON RRRAAA.RRRAAA=VXH_T.VXH_T AND RRRAAA.RRRAAA4=VXH_T.VXH_T4) ON IHOURSINST.IHOURSINST=VXH_T.VXH_T AND IHOURSINST.IHOURSINST3=VXH_T.VXH_T6 AND IHOURSINST.IHOURSINST4=VXH_T.VXH_T7 WHERE VXH_T.LEVEL > 0 GROUP BY VXH_T.VXH_T,VXH_T.VXH_T2,VXH_T.VXH_T3,ICA.ICA3,RRRAAA.RRRAAA3,VXH_T.VXH_T4,VXH_T.VXH_T5,VXH_T.VXH_T6,VXH_T.VXH_T7;
DELETE FROM [Heat Transfer - Time] WHERE NOT (([Heat Transfer - Time].BaseYear=[Heat Transfer - Time].ModelYear AND [Heat Transfer - Time].BaseYear<(SELECT MAX([Heat Transfer - Time].BaseYear) FROM [Heat Transfer - Time])) OR ([Heat Transfer - Time].BaseYear=(SELECT MAX([Heat Transfer - Time].BaseYear) FROM [Heat Transfer - Time]) )) ;
DROP TABLE if exists `Economy`;
CREATE TABLE `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`Demand UserGroup`,`Category`,`Value` REAL);
INSERT INTO `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Demand UserGroup`,`Category`,`Value`) SELECT DE_T.[Case],EPR.BaseYear,EPR.ModelYear,DE_T.Country,DE_T.Region,DE_T.UserGroup,'Consumer price €/MWh', sum(0.001*OMONEY.value*DE_T.MWh*EPR.[OMONEY/MWh]/DE.GWh) FROM OMONEY INNER JOIN ([Electricity Demand - Annual] AS DE INNER JOIN ([Electricity Demand - Term] AS DE_T INNER JOIN [Electricity_price] AS EPR ON DE_T.[Case] = EPR.[Case] AND DE_T.[Year] = EPR.[ModelYear] AND DE_T.[Region] = EPR.[Region] AND DE_T.[Season] = EPR.[Season] AND DE_T.[Term] = EPR.[Term]) ON DE.[Case] = EPR.[Case] AND DE.[Year] =EPR.[ModelYear] AND DE.[Region]=EPR.[Region]) ON OMONEY.OMONEY= DE.[Case] GROUP BY DE_T.[Case],EPR.BaseYear,EPR.ModelYear,DE_T.Country,DE_T.Region;
INSERT INTO `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Demand UserGroup`,`Category`,`Value`) SELECT DE_T.[Case],EPR.BaseYear,EPR.ModelYear,DE_T.Country,DE_T.Region,DE_T.UserGroup,'Consumer costs M€', sum(0.000001*OMONEY.value*DE_T.MWh*EPR.[OMONEY/MWh]) FROM OMONEY INNER JOIN ([Electricity Demand - Term] AS DE_T INNER JOIN [Electricity_price] AS EPR ON DE_T.[Case]=EPR.[Case] AND DE_T.[Year]=EPR.[ModelYear] AND DE_T.[Region]=EPR.[Region] AND DE_T.[Season]=EPR.[Season] AND DE_T.[Term]=EPR.[Term]) ON OMONEY.OMONEY=DE_T.[Case] GROUP BY DE_T.[Case],EPR.BaseYear,EPR.ModelYear,DE_T.Country,DE_T.Region;
INSERT INTO `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`Category`,`Value`) SELECT GE_T.[Case],GE_T.BaseYear,GE_T.ModelYear,GE_T.Country,GE_T.Region,GE_T.Area,GE_T.Fuel,GE_T.[Technology Category],GE_T.[Technology Type],GE_T.Technology,'Producer price €/MWh', sum(0.000001*OMONEY.value*GE_T.MWh*EPR.[OMONEY/MWh]/GE.TWh) FROM OMONEY INNER JOIN ([Electricity generation - Annual] AS GE INNER JOIN ([Electricity generation - Term] AS GE_T INNER JOIN [Electricity_price] AS EPR ON GE_T.[Case]=EPR.[Case] AND GE_T.[BaseYear]=EPR.[BaseYear] AND GE_T.[ModelYear]=EPR.[ModelYear] AND GE_T.[Region] = EPR.[Region] AND GE_T.[Season] = EPR.[Season] AND GE_T.[Term] = EPR.[Term]) ON GE.[Case]=GE_T.[Case] AND GE.[BaseYear]=GE_T.[BaseYear] AND GE.[ModelYear]=GE_T.[ModelYear] AND GE.[Area]=GE_T.[Area] AND GE.[Technology]=GE_T.[Technology]) ON OMONEY.OMONEY=GE.[Case] GROUP BY GE_T.[Case],GE_T.BaseYear,GE_T.ModelYear,GE_T.Country,GE_T.Region,GE_T.Area,GE_T.Fuel,GE_T.Technology;
INSERT INTO `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`Category`,`Value`) SELECT GE_T.[Case],GE_T.BaseYear,GE_T.ModelYear,GE_T.Country,GE_T.Region,GE_T.Area,GE_T.Fuel,GE_T.[Technology Category],GE_T.[Technology Type],GE_T.Technology,'Producer revenue M€',sum(0.000001*GE_T.MWh*EPR.[OMONEY/MWh]) FROM OMONEY INNER JOIN ([Electricity generation - Term] AS GE_T INNER JOIN [Electricity_price] AS EPR ON GE_T.[Case] = EPR.[Case] AND GE_T.[BaseYear] = EPR.[BaseYear] AND GE_T.[ModelYear] = EPR.[ModelYear] AND GE_T.Region = EPR.Region AND GE_T.[Season] = EPR.[Season] AND GE_T.[Term] = EPR.[Term]) ON OMONEY.OMONEY=GE_T.[Case] GROUP BY GE_T.[Case],GE_T.BaseYear,GE_T.ModelYear,GE_T.Country,GE_T.Region,GE_T.Area,GE_T.Fuel,GE_T.Technology;
INSERT INTO `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`Category`,`Value`) SELECT GE.[Case],GE.BaseYear,GE.ModelYear,GE.Country,GE.Region,GE.Area,GE.Fuel,GE.[Technology Category],GE.[Technology Type],GE.Technology,'Utilization hours - Electricity', sum(1000000*GE.TWh/ECAP.MW) FROM [Electricity generation - Annual] AS GE INNER JOIN [Electricity generation capacity Total] AS ECAP ON GE.[Case]=ECAP.[Case] AND GE.BaseYear=ECAP.BaseYear AND GE.ModelYear=ECAP.ModelYear AND GE.Area=ECAP.Area AND GE.Technology=ECAP.Technology GROUP BY GE.[Case],GE.BaseYear,GE.ModelYear,GE.Country,GE.Region,GE.Area,GE.Fuel,GE.Technology;
INSERT INTO `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`Category`,`Value`) SELECT ECAP.[Case],ECAP.BaseYear,ECAP.ModelYear,ECAP.Country,ECAP.Region ,ECAP.Area,ECAP.Fuel,ECAP.[Technology Category],ECAP.[Technology Type],ECAP.Technology, 'Curtailment GWh', 0.001*sum(ECAP.MW*WNDFLH.value)-1000*GE.TWh FROM [Electricity generation - Annual] AS GE INNER JOIN ([Electricity generation capacity Total] AS ECAP INNER JOIN WNDFLH ON ECAP.[Case]=WNDFLH.WNDFLH AND ECAP.Area=WNDFLH.WNDFLH3) ON GE.[Case]=ECAP.[Case] AND GE.BaseYear=ECAP.BaseYear AND GE.ModelYear=ECAP.ModelYear AND GE.Area=ECAP.Area AND GE.Technology=ECAP.Technology WHERE ECAP.Fuel IN ('WIND') GROUP BY ECAP.[Case],ECAP.BaseYear,ECAP.ModelYear,ECAP.Country,ECAP.Region ,ECAP.Area,ECAP.Fuel,ECAP.Technology UNION SELECT ECAP.[Case],ECAP.BaseYear,ECAP.ModelYear,ECAP.Country,ECAP.Region ,ECAP.Area,ECAP.Fuel,ECAP.[Technology Category],ECAP.[Technology Type],ECAP.Technology, 'Curtailment GWh', 0.001*sum(ECAP.MW*SOLEFLH.value)-1000*GE.TWh FROM [Electricity generation - Annual] AS GE INNER JOIN ([Electricity generation capacity Total] AS ECAP INNER JOIN SOLEFLH ON ECAP.[Case]=SOLEFLH.SOLEFLH AND ECAP.Area=SOLEFLH.SOLEFLH3) ON GE.[Case]=ECAP.[Case] AND GE.BaseYear=ECAP.BaseYear AND GE.ModelYear=ECAP.ModelYear AND GE.Area=ECAP.Area AND GE.Technology=ECAP.Technology WHERE ECAP.Fuel IN ('SUN') GROUP BY ECAP.[Case],ECAP.BaseYear,ECAP.ModelYear,ECAP.Country,ECAP.Region ,ECAP.Area,ECAP.Fuel,ECAP.Technology;
INSERT INTO `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`Category`,`Value`) SELECT VGKN.VGKN,VGKN.VGKN2,VGKN.VGKN3,ICA.ICA3,RRRAAA.RRRAAA3,VGKN.VGKN4,Tech.[Fuel Type],Tech.[Technology Category],Tech.[Technology Type],VGKN.VGKN5,'Investments in generation capacity', sum(ANNUITYCG.value*VGKN.LEVEL*IC.value*OMONEY.value) FROM [Technology characteristics] AS Tech INNER JOIN (ANNUITYCG INNER JOIN (RRRAAA INNER JOIN (ICA INNER JOIN (OMONEY INNER JOIN (VGKN INNER JOIN GINVCOST AS IC ON VGKN.VGKN = IC.GINVCOST AND VGKN.VGKN4=IC.GINVCOST3 AND VGKN.VGKN5=IC.GINVCOST4) ON OMONEY.OMONEY=VGKN.VGKN) ON ICA.ICA=VGKN.VGKN AND ICA.ICA4=VGKN.VGKN4) ON RRRAAA.RRRAAA=VGKN.VGKN AND RRRAAA.RRRAAA4=VGKN.VGKN4) ON ANNUITYCG.ANNUITYCG=VGKN.VGKN AND ANNUITYCG.ANNUITYCG3=ICA.ICA3 AND ANNUITYCG.ANNUITYCG4=VGKN.VGKN5) ON Tech.[Case]=VGKN.VGKN AND Tech.[Technology]=VGKN.VGKN5 WHERE VGKN.LEVEL>0 AND VGKN.VGKN3>= VGKN.VGKN2 GROUP BY VGKN.VGKN,VGKN.VGKN2,VGKN.VGKN3,ICA.ICA3,RRRAAA.RRRAAA3,VGKN.VGKN4,VGKN.VGKN5;
INSERT INTO `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`Category`,`Value`) SELECT FCON.[Case],FCON.BaseYear,FCON.ModelYear,FCON.Country,FCON.Region,FCON.Area,FCON.Fuel,FCON.[Technology Category],FCON.[Technology Type],FCON.Technology,'Fuel costs M€', sum(FCON.PJ*FP.value*OMONEY.value) FROM OMONEY INNER JOIN ([Fuel_consumption] AS FCON INNER JOIN FUELPRICE AS FP ON FCON.[Case] = FP.FUELPRICE AND FCON.[ModelYear]=FP.FUELPRICE3 AND FCON.Area=FP.FUELPRICE4 AND FCON.FUEL = FP.FUELPRICE5) ON OMONEY.OMONEY=FCON.[Case] GROUP BY FCON.[Case],FCON.BaseYear,FCON.ModelYear,FCON.Country, FCON.Region,FCON.Area, FCON.Fuel, FCON.Technology;
INSERT INTO `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`Category`,`Value`) SELECT EM.[Case],EM.BaseYear,EM.ModelYear,EM.Country,EM.Region,EM.Area,EM.Fuel,EM.[Technology Category],EM.[Technology Type],EM.Technology,'CO2 Emission costs M€', 0.001*sum(EM.[CO2 kilotons]*OMONEY.value*M_POL.value) FROM OMONEY INNER JOIN ([Emissions - Annual] AS EM INNER JOIN M_POL ON EM.[Case] = M_POL.M_POL AND EM.Country=M_POL.M_POL5 and EM.ModelYear = M_POL.M_POL3) ON OMONEY.OMONEY=EM.[Case] WHERE M_POL.M_POL4='TAX_CO2' AND EM.[CO2 kilotons]>0 GROUP BY EM.[Case],EM.BaseYear,EM.ModelYear,EM.Country,EM.Region,EM.Area,EM.Fuel,EM.Technology UNION SELECT EM.[Case],EM.BaseYear,EM.ModelYear,EM.Country,EM.Region,EM.Area,EM.Fuel,EM.[Technology Category],EM.[Technology Type],EM.Technology,'SO2 Emission costs M€', 0.001*sum(EM.[SO2 kilotons]*OMONEY.value*M_POL.value) FROM OMONEY INNER JOIN ([Emissions - Annual] AS EM INNER JOIN M_POL ON EM.[Case] = M_POL.M_POL AND EM.Country=M_POL.M_POL5 and EM.ModelYear = M_POL.M_POL3 ) ON OMONEY.OMONEY=EM.[Case] WHERE M_POL.M_POL4='TAX_SO2' AND EM.[SO2 kilotons]>0 GROUP BY EM.[Case], EM.BaseYear,EM.ModelYear, EM.Country, EM.Region,EM.Area, EM.Fuel, EM.Technology UNION SELECT EM.[Case],EM.BaseYear,EM.ModelYear,EM.Country,EM.Region,EM.Area,EM.Fuel,EM.[Technology Category],EM.[Technology Type],EM.Technology,'NOx Emission costs M€', 0.001*sum(EM.[N2O kilotons]*OMONEY.value*M_POL.value) FROM OMONEY INNER JOIN ([Emissions - Annual] AS EM INNER JOIN M_POL ON EM.[Case] = M_POL.M_POL AND EM.Country=M_POL.M_POL5 and EM.ModelYear = M_POL.M_POL3 ) ON OMONEY.OMONEY=EM.[Case] WHERE M_POL.M_POL4='TAX_NOx'  AND EM.[N2O kilotons]>0 GROUP BY EM.[Case], EM.BaseYear,EM.ModelYear, EM.Country, EM.Region,EM.Area, EM.Fuel, EM.Technology;
INSERT INTO `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`Category`,`Value`) SELECT CAP.[Case],CAP.BaseYear,CAP.ModelYear,CAP.Country,CAP.Region,CAP.Area,CAP.Fuel,CAP.[Technology Category],CAP.[Technology Type],CAP.Technology,'Power plant O&M (Fixed)',0.001*sum(OMONEY.value*FCOST.value*CAP.MW) FROM OMONEY INNER JOIN (Cap_Tot AS CAP INNER JOIN GOMFCOST AS FCOST ON CAP.[Case]=FCOST.GOMFCOST AND CAP.Area=GOMFCOST3 AND CAP.Technology=GOMFCOST4) ON OMONEY.OMONEY=CAP.[Case] GROUP BY CAP.[Case],CAP.BaseYear,CAP.ModelYear,CAP.Country,CAP.Region,CAP.Area,CAP.Fuel,CAP.Technology;
INSERT INTO `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`Category`,`Value`) SELECT GE.[Case],GE.BaseYear,GE.ModelYear,GE.Country,GE.Region,GE.Area,GE.Fuel,GE.[Technology Category],GE.[Technology Type],GE.Technology,'Power plant O&M (Variable)',sum(OMONEY.value*VCOST.value*GE.TWh) FROM OMONEY INNER JOIN ([Electricity generation - Annual] AS GE INNER JOIN GOMVCOST AS VCOST ON GE.[Case]=VCOST.GOMVCOST AND GE.Area=GOMVCOST3 AND GE.Technology=GOMVCOST4) ON OMONEY.OMONEY=GE.[Case] GROUP BY GE.[Case],GE.BaseYear,GE.ModelYear,GE.Area,GE.Fuel,GE.Technology UNION SELECT GH.[Case],GH.BaseYear,GH.ModelYear,GH.Country,GH.Region,GH.Area,GH.Fuel,GH.[Technology Category],GH.[Technology Type],GH.Technology,'Power plant O&M (Variable)',sum(OMONEY.value*VCOST.value*GH.TWh*Tech.[CHP CV-value]) FROM [Technology characteristics] AS Tech INNER JOIN (OMONEY INNER JOIN ([Heat generation - Annual] AS GH INNER JOIN GOMVCOST AS VCOST ON GH.[Case]=VCOST.GOMVCOST AND GH.Area=GOMVCOST3 AND GH.Technology=GOMVCOST4) ON OMONEY.OMONEY=GH.[Case]) ON Tech.[Case]=GH.[Case] AND Tech.[Technology]=GH.Technology GROUP BY GH.[Case],GH.BaseYear,GH.ModelYear,GH.Area,GH.Fuel,GH.Technology;
INSERT INTO `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Category`,`Value`) SELECT XIN.[Case],XIN.BaseYear,XIN.ModelYear,XIN.[Import Country],XIN.[Import Region],'Transmission network investments',0.5*sum(OMONEY.value*XIN.MW*ANNUITYCX.value*XINVCOST.value)/1000000 FROM XINVCOST INNER JOIN (OMONEY INNER JOIN ([Transmission Investments] AS XIN INNER JOIN ANNUITYCX ON XIN.[Case]=ANNUITYCX.ANNUITYCX AND XIN.[Import Country]=ANNUITYCX.ANNUITYCX3) ON OMONEY.OMONEY=XIN.[Case]) ON XINVCOST.XINVCOST=XIN.[Case] AND XINVCOST.XINVCOST3=XIN.ModelYear AND XINVCOST.XINVCOST4=XIN.[Export Region] AND XINVCOST.XINVCOST5=XIN.[Import Region] GROUP BY XIN.[Case],XIN.BaseYear,XIN.ModelYear,XIN.[Import Country],XIN.[Import Region] UNION SELECT XIN.[Case],XIN.BaseYear,XIN.ModelYear,XIN.[Export Country],XIN.[Export Region],'Transmission network investments',0.5*sum(OMONEY.value*XIN.MW*ANNUITYCX.value*XINVCOST.value)/1000000 FROM XINVCOST INNER JOIN (OMONEY INNER JOIN ([Transmission Investments] AS XIN INNER JOIN ANNUITYCX ON XIN.[Case]=ANNUITYCX.ANNUITYCX AND XIN.[Export Country]=ANNUITYCX.ANNUITYCX3) ON OMONEY.OMONEY=XIN.[Case]) ON XINVCOST.XINVCOST=XIN.[Case] AND XINVCOST.XINVCOST3=XIN.ModelYear AND XINVCOST.XINVCOST4=XIN.[Export Region] AND XINVCOST.XINVCOST5=XIN.[Import Region] GROUP BY XIN.[Case],XIN.BaseYear,XIN.ModelYear,XIN.[Export Country],XIN.[Export Region];
INSERT INTO `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Category`,`Value`) SELECT EX.[Case],EX.BaseYear,EX.ModelYear,EX.Country_Import,EX.Region_Import,'Transmission network O&M',0.5*sum(OMONEY.value*EX.GWh*XCOST.value)/1000 FROM (OMONEY INNER JOIN ([El Transmission between Countries] AS EX INNER JOIN XCOST ON EX.[Case]=XCOST.XCOST AND EX.Region_Import=XCOST.XCOST4 AND EX.Region_Export=XCOST.XCOST3) ON OMONEY.OMONEY=EX.[Case]) GROUP BY EX.[Case],EX.BaseYear,EX.ModelYear,EX.Country_Import,EX.Region_Import UNION SELECT EX.[Case],EX.BaseYear,EX.ModelYear,EX.Country_Export,EX.Region_Export,'Transmission network O&M',0.5*sum(OMONEY.value*EX.GWh*XCOST.value)/1000 FROM (OMONEY INNER JOIN ([El Transmission between Countries] AS EX INNER JOIN XCOST ON EX.[Case]=XCOST.XCOST AND EX.Region_Import=XCOST.XCOST4 AND EX.Region_Export=XCOST.XCOST3) ON OMONEY.OMONEY=EX.[Case]) GROUP BY EX.[Case],EX.BaseYear,EX.ModelYear,EX.Country_Export,EX.Region_Export;
INSERT INTO `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`Category`,`Value`) SELECT FCON.[Case],FCON.BaseYear,FCON.ModelYear,FCON.Country,FCON.Region,FCON.Area,FCON.Fuel,FCON.[Technology Category],FCON.[Technology Type],FCON.Technology,'Fuel used for electricity generation, PJ',sum(FCON.PJ*GE.PJ/(GH.PJ+GE.PJ)) FROM [Heat Generation - Annual] AS GH INNER JOIN ([Fuel_Consumption] AS FCON INNER JOIN [Electricity generation - Annual] AS GE ON GE.[Case]=FCON.[Case] AND GE.BaseYear=FCON.BaseYear AND GE.ModelYear=FCON.ModelYear AND GE.Area=FCON.Area AND GE.Technology=FCON.Technology) ON GH.[Case]=FCON.[Case] AND GH.BaseYear=FCON.BaseYear AND GH.ModelYear=FCON.ModelYear AND GH.Area=FCON.Area AND GH.Technology=FCON.Technology GROUP BY FCON.[Case],FCON.BaseYear,FCON.ModelYear,FCON.Country,FCON.Region,FCON.Area,FCON.Fuel,FCON.Technology UNION SELECT FCON.[Case],FCON.BaseYear,FCON.ModelYear,FCON.Country,FCON.Region,FCON.Area,FCON.Fuel,FCON.[Technology Category],FCON.[Technology Type],FCON.Technology,'Fuel used for heat generation, PJ',sum(FCON.PJ*GH.PJ/(GH.PJ+GE.PJ)) FROM [Heat Generation - Annual] AS GH INNER JOIN ([Fuel_Consumption] AS FCON INNER JOIN [Electricity generation - Annual] AS GE ON GE.[Case]=FCON.[Case] AND GE.BaseYear=FCON.BaseYear AND GE.ModelYear=FCON.ModelYear AND GE.Area=FCON.Area AND GE.Technology=FCON.Technology) ON GH.[Case]=FCON.[Case] AND GH.BaseYear=FCON.BaseYear AND GH.ModelYear=FCON.ModelYear AND GH.Area=FCON.Area AND GH.Technology=FCON.Technology GROUP BY FCON.[Case],FCON.BaseYear,FCON.ModelYear,FCON.Country,FCON.Region,FCON.Area,FCON.Fuel,FCON.Technology;
INSERT INTO `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Area`,`Fuel`,`Technology Category`,`Technology Type`,`Technology`,`Category`,`Value`) SELECT GR_EC_OUTPUT_TECH.GR_EC_OUTPUT_TECH,'TEMPYEAR',GR_EC_OUTPUT_TECH.GR_EC_OUTPUT_TECH3,ICA.ICA3,RRRAAA.RRRAAA,GR_EC_OUTPUT_TECH.GR_EC_OUTPUT_TECH4,Tech.[Fuel Type],Tech.[Technology Category],Tech.[Technology Type],GR_EC_OUTPUT_TECH.GR_EC_OUTPUT_TECH5,'Grid rent Technology', sum(OMONEY.value*GR_EC_OUTPUT_TECH.VALUE) FROM OMONEY INNER JOIN (RRRAAA INNER JOIN (ICA INNER JOIN (GR_EC_OUTPUT_TECH INNER JOIN [Technology characteristics] AS Tech ON GR_EC_OUTPUT_TECH.GR_EC_OUTPUT_TECH=Tech.[Case] AND GR_EC_OUTPUT_TECH.GR_EC_OUTPUT_TECH5=Tech.Technology) ON ICA.ICA=Tech.[Case] AND ICA.ICA4= GR_EC_OUTPUT_TECH.GR_EC_OUTPUT_TECH4) ON RRRAAA.RRRAAA=Tech.[Case] AND RRRAAA.RRRAAA4= GR_EC_OUTPUT_TECH.GR_EC_OUTPUT_TECH4) ON OMONEY.OMONEY=Tech.[Case] GROUP BY GR_EC_OUTPUT_TECH.GR_EC_OUTPUT_TECH,'TEMPYEAR',GR_EC_OUTPUT_TECH.GR_EC_OUTPUT_TECH3,GR_EC_OUTPUT_TECH.GR_EC_OUTPUT_TECH4,GR_EC_OUTPUT_TECH.GR_EC_OUTPUT_TECH5 UNION SELECT GR_FC_OUTPUT_TECH.GR_FC_OUTPUT_TECH,'TEMPYEAR',GR_FC_OUTPUT_TECH.GR_FC_OUTPUT_TECH3,ICA.ICA3,RRRAAA.RRRAAA,GR_FC_OUTPUT_TECH.GR_FC_OUTPUT_TECH4,Tech.[Fuel Type],Tech.[Technology Category],Tech.[Technology Type],GR_FC_OUTPUT_TECH.GR_FC_OUTPUT_TECH5,'GRID rent Technology', sum(OMONEY.value*GR_FC_OUTPUT_TECH.VALUE) FROM OMONEY INNER JOIN (RRRAAA INNER JOIN (ICA INNER JOIN (GR_FC_OUTPUT_TECH INNER JOIN [Technology characteristics] AS Tech ON GR_FC_OUTPUT_TECH.GR_FC_OUTPUT_TECH=Tech.[Case] AND GR_FC_OUTPUT_TECH.GR_FC_OUTPUT_TECH5=Tech.Technology) ON ICA.ICA=Tech.[Case] AND ICA.ICA4= GR_FC_OUTPUT_TECH.GR_FC_OUTPUT_TECH4) ON RRRAAA.RRRAAA=Tech.[Case] AND RRRAAA.RRRAAA4= GR_FC_OUTPUT_TECH.GR_FC_OUTPUT_TECH4) ON OMONEY.OMONEY=Tech.[Case] GROUP BY GR_FC_OUTPUT_TECH.GR_FC_OUTPUT_TECH,'TEMPYEAR',GR_FC_OUTPUT_TECH.GR_FC_OUTPUT_TECH3,GR_FC_OUTPUT_TECH.GR_FC_OUTPUT_TECH4,GR_FC_OUTPUT_TECH.GR_FC_OUTPUT_TECH5;
INSERT INTO `Economy`(`Case`,`BaseYear`,`ModelYear`,`Country`,`Region`,`Demand UserGroup`,`Category`,`Value`) SELECT GR_DC_OUTPUT_USER.GR_DC_OUTPUT_USER,'TEMPYEAR',GR_DC_OUTPUT_USER.GR_DC_OUTPUT_USER3,CCCRRR.CCCRRR3,GR_DC_OUTPUT_USER.GR_DC_OUTPUT_USER4,GR_DC_OUTPUT_USER.GR_DC_OUTPUT_USER5,'Grid Tariff Consumer', sum(OMONEY.value*GR_DC_OUTPUT_USER.value) FROM OMONEY INNER JOIN (CCCRRR INNER JOIN GR_DC_OUTPUT_USER ON CCCRRR.CCCRRR=GR_DC_OUTPUT_USER.GR_DC_OUTPUT_USER AND CCCRRR.CCCRRR4=GR_DC_OUTPUT_USER.GR_DC_OUTPUT_USER4) ON CCCRRR.CCCRRR=OMONEY.OMONEY GROUP BY GR_DC_OUTPUT_USER.GR_DC_OUTPUT_USER,'TEMPYEAR',GR_DC_OUTPUT_USER.GR_DC_OUTPUT_USER3,GR_DC_OUTPUT_USER.GR_DC_OUTPUT_USER4,GR_DC_OUTPUT_USER.GR_DC_OUTPUT_USER5 UNION SELECT GR_EC_OUTPUT_USER.GR_EC_OUTPUT_USER,'TEMPYEAR',GR_EC_OUTPUT_USER.GR_EC_OUTPUT_USER3,CCCRRR.CCCRRR3,GR_EC_OUTPUT_USER.GR_EC_OUTPUT_USER4,GR_EC_OUTPUT_USER.GR_EC_OUTPUT_USER5,'Grid Tariff Consumer', sum(OMONEY.value*GR_EC_OUTPUT_USER.value) FROM OMONEY INNER JOIN (CCCRRR INNER JOIN GR_EC_OUTPUT_USER ON CCCRRR.CCCRRR=GR_EC_OUTPUT_USER.GR_EC_OUTPUT_USER AND CCCRRR.CCCRRR4=GR_EC_OUTPUT_USER.GR_EC_OUTPUT_USER4) ON CCCRRR.CCCRRR=OMONEY.OMONEY GROUP BY GR_EC_OUTPUT_USER.GR_EC_OUTPUT_USER,'TEMPYEAR',GR_EC_OUTPUT_USER.GR_EC_OUTPUT_USER3,GR_EC_OUTPUT_USER.GR_EC_OUTPUT_USER4,GR_EC_OUTPUT_USER.GR_EC_OUTPUT_USER5;
DELETE FROM [Economy] WHERE NOT ((BaseYear=ModelYear AND BaseYear<(SELECT MAX(BaseYear) FROM [Economy])) OR (BaseYear=(SELECT MAX(BaseYear) FROM [Economy])));
